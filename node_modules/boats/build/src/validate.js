"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const cloneObject_1 = tslib_1.__importDefault(require("./cloneObject"));
const swagger_parser_1 = tslib_1.__importDefault(require("@apidevtools/swagger-parser"));
const parser_1 = tslib_1.__importDefault(require("@asyncapi/parser"));
const generatePermissionsSchema_1 = tslib_1.__importDefault(require("./generatePermissionsSchema"));
class Validate {
    async decideThenValidate(bundledJson, boatsRc) {
        var _a;
        bundledJson = generatePermissionsSchema_1.default(bundledJson, (_a = boatsRc.permissionConfig) === null || _a === void 0 ? void 0 : _a.generateSchemaNamed);
        if (bundledJson.asyncapi) {
            return this.asyncapi(JSON.stringify(bundledJson));
        }
        if (bundledJson.openapi || bundledJson.swagger) {
            return this.openapi(bundledJson);
        }
    }
    openapi(input) {
        return new Promise((resolve, reject) => {
            if (typeof input === 'object') {
                input = cloneObject_1.default(input);
            }
            swagger_parser_1.default.validate(input, {})
                .then((data) => {
                resolve(data);
            })
                .catch((err) => {
                reject(err);
            });
        });
    }
    asyncapi(input) {
        return new Promise((resolve, reject) => {
            parser_1.default
                .parse(input)
                .then((data) => {
                resolve(data);
            })
                .catch((err) => {
                reject(err);
            });
        });
    }
}
exports.default = new Validate();
